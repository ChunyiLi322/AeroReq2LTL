<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Textarea Conditional Dropdown Example</title>
    <style>
        #dropdown {
            display: none;
            position: absolute;
            background-color: rgba(104, 104, 104, 0.05);
            border-color: #3c763d;
            border: 1px solid #ddd;
            cursor: pointer;
            padding: 5px;
        }
        #dropdown div:hover {
            background-color: rgba(0, 174, 239, 0.3);
        }
    </style>
</head>
<body>

<textarea id="inputText" placeholder="尝试选中'菠萝'这个词..." onclick="checkSelection()"></textarea>
<div id="dropdown">
    <div onclick="replaceText('苹果')">苹果</div>
    <div onclick="replaceText('香蕉')">香蕉</div>
    <div onclick="replaceText('橙子')">橙子</div>
</div>

<script>
    function checkSelection() {
        const textarea = document.getElementById('inputText');
        const text = textarea.value;
        const selStart = textarea.selectionStart;
        const selEnd = textarea.selectionEnd;
        const selectedText = text.substring(selStart, selEnd);

        if (selectedText === "菠萝") {
            const textarea = document.getElementById('inputText');
            const dropdown = document.getElementById('dropdown');
            if (textarea.selectionStart !== textarea.selectionEnd) {
                dropdown.style.display = 'block';
                dropdown.style.left = event.clientX + 'px'; // 定位到鼠标点击的位置
                dropdown.style.top = event.clientY + 'px';
            } else {
                dropdown.style.display = 'none';
            }
        } else {
            document.getElementById('dropdown').style.display = 'none';
        }
    }

    function replaceText(newText) {
        const textarea = document.getElementById('inputText');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const textValue = textarea.value;
        textarea.value = textValue.substring(0, start) + newText + textValue.substring(end);
        document.getElementById('dropdown').style.display = 'none';
        textarea.focus(); // Re-focus on the textarea
    }


    function showDropdown() {
        const textarea = document.getElementById('inputText');
        const dropdown = document.getElementById('dropdown');
        if (textarea.selectionStart !== textarea.selectionEnd) {
            dropdown.style.display = 'block';
            dropdown.style.left = event.clientX + 'px'; // 定位到鼠标点击的位置
            dropdown.style.top = event.clientY + 'px';
        } else {
            dropdown.style.display = 'none';
        }
    }
</script>

</body>
</html>
